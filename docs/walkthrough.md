# 캘린더 → 시트 자동 등록 기능 구현 완료

## 변경 내용

### [auto_organizer_console.py](file:///Users/jinito/Workspaces/Opencode/studiobday-automation/auto_organizer_console.py) (v5.1 → v5.2)

**신규 함수 3개 추가:**

| 함수 | 역할 |
|------|------|
| `parse_calendar_event(event)` | 이벤트 제목+본문에서 고객명, 인원수, 등급 파싱 |
| `_get_sheet_rows()` | 시트 행 조회 헬퍼 |
| `sync_calendar_to_sheets()` | 중복 체크 후 미등록 고객 자동 추가 |

**기존 함수 수정:**

- `get_pending_basic()` — 전화번호 없으면 `"전화번호 미입력 → 발송 대기"` 로그 후 스킵
- `get_pending_premium()` — 1차 발송 시 전화번호 없으면 동일 로그 후 스킵
- `main()` — `process_appointments()` 직후 `sync_calendar_to_sheets()` 호출 추가

**기존 발송 로직 변경 없음** ✅

## 검증 결과 (2026-02-14)

- ✅ **구글 캘린더 → 시트 동기화**: `v5.2` 실행 시 기존 예약(`홍*철`, `김*용` 등)을 정확히 인식하고 중복 등록을 방지(Skip)하는 것을 확인했습니다.
- ✅ **OAuth 인증 복구**: 만료되었던 구글 시트 토큰을 재발급하여 자동화 시스템을 다시 정상화했습니다.
- ✅ **장애 알림 강화**: 시스템 오류나 인증 만료 시 텔레그램으로 즉시 알림이 오도록 조치했습니다. (v5.8)
- ✅ **Firebase 비용 절감**: 링크 생성 7일 후 파일을 자동 삭제하는 로직(v5.9)을 통해 무료 용량(5GB) 내에서 지속 운영이 가능하게 했습니다.
- [x] 고객 안내 문구에 "7일 만료" 자동 포함 (v5.9)
- [x] **중복 실행 방지(File Lock)**: 병렬 실행에 의한 데이터 중복 등록 문제 해결 (v6.0)

## 🤖 클로바 챗봇 & 네이버 톡톡 연동 (진행 중)
네이버 톡톡 상담 자동화를 위해 클로바 챗봇 설정을 진행하고 있습니다.

### 1. 현재까지 진행 상황
- **기획 및 분석**: 톡톡-챗봇 연동 구조(Invoke URL, Token) 분석 완료
- **도메인 셋업**: NCP '스튜디오생일' 챗봇 도메인 접속 및 기본 뼈대 확인
- **가이드 구축**: 사용자의 정확한 사실 정보 입력을 돕기 위한 매뉴얼(`manual_setup_guide.md`) 제공

### 2. 향후 워크플로우
- **[사용자]** 챗봇 빌더에서 인사말, 위치, 가격(bdaystudio.store) 등 기반 정보 입력
- **[기술 연동]** 톡톡 파트너 센터에 Invoke URL 등록 및 채널 토큰을 챗봇 빌더에 입력
- **[배포]** 학습 수행 및 서비스 배포를 통해 실제 톡톡 채널에 적용

## 향후 관리

- **자동 실행**: Synology 작업 스케줄러에 의해 5분마다 계속 일합니다.
- **전화번호 입력**: 등록된 신규 고객의 전화번호만 시트에 채워주시면, 다음 주기에 바로 발송이 진행됩니다.
